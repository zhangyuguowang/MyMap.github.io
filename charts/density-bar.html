<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼ä¸­å›½äººå£å¯†åº¦å¯è§†åŒ–</title>
    
    <!-- EChartsæ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <!-- å¼•å…¥jQueryç”¨äºDOMæ“ä½œç®€åŒ– -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* å®¹å™¨åŒ…è£…ï¼Œé™åˆ¶æœ€å¤§å®½åº¦ */
        .container-wrapper {
            width: 100%;
            max-width: 1400px;
            display: flex;
            justify-content: center;
        }
        
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #4facfe;
        }
        
        .control-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .control-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .control-section h3 {
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .control-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }
        
        .control-btn.small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .control-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 10px rgba(240, 147, 251, 0.3);
        }
        
        .control-btn.secondary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.3);
        }
        
        .control-btn.secondary:hover {
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.4);
        }
        
        /* çœä»½é€‰æ‹©åŒºåŸŸ */
        .province-selector {
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #eaeaea;
        }
        
        .province-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }
        
        .province-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .province-item:hover {
            background: #e9ecef;
        }
        
        .province-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .province-item.highlight.selected {
         background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
         color: white;
        }
        
        .province-checkbox {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 2px solid #adb5bd;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .province-item.selected .province-checkbox,
        .province-item.highlight .province-checkbox {
            border-color: white;
            background: white;
        }
        
        .province-item.selected .province-checkbox::after,
        .province-item.highlight.selected .province-checkbox::after {
            content: 'âœ“';
            color: #667eea;
            font-weight: bold;
            font-size: 12px;
        }
        
        .province-name {
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }
        
        #densityChart {
            flex: 1;
            min-height: 500px;
            width: 100%;
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #4facfe;
        }
        
        .stat-card.highlight {
            border-left-color: #f093fb;
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .stat-detail {
            font-size: 12px;
            color: #adb5bd;
            margin-top: 5px;
        }
        
        /* åº•éƒ¨ä¿¡æ¯ */
        .footer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .header .subtitle {
                font-size: 14px;
            }
            
            .control-panel {
                padding: 12px;
            }
            
            .province-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .province-name {
                font-size: 12px;
            }
            
            .control-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .chart-container {
                padding: 15px;
            }
            
            #densityChart {
                min-height: 400px;
            }
            
            .stats-info {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .chart-container {
                padding: 10px;
            }
            
            .province-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .control-buttons {
                justify-content: center;
            }
        }
        
        @media (min-width: 1200px) {
            .container {
                max-width: 1100px;
            }
            
            .chart-container {
                min-height: 550px;
            }
        }
    </style>
</head>
<body>
    <div class="container-wrapper">
        <div class="container">
            <div class="header">
                <h1>äº¤äº’å¼ä¸­å›½äººå£å¯†åº¦å¯è§†åŒ–</h1>
                <div class="subtitle">è‡ªå®šä¹‰é€‰æ‹©çœä»½ï¼Œæ¢ç´¢ä¸­å›½å„åœ°åŒºäººå£åˆ†å¸ƒç‰¹å¾</div>
                
                <div class="control-panel">
                    <div class="control-section">
                        <h3><i class="icon">ğŸŒ</i> æ˜¾ç¤ºæ¨¡å¼</h3>
                        <div class="control-buttons">
                            <button class="control-btn active" id="modeCustom">
                                <i class="icon">ğŸ¯</i> è‡ªå®šä¹‰é€‰æ‹©æ¨¡å¼
                            </button>
                            <button class="control-btn secondary" id="modeTop10">
                                <i class="icon">ğŸ“Š</i> Top10æ’åæ¨¡å¼
                            </button>
                            <button class="control-btn secondary" id="modeExcludeHKMO">
                                <i class="icon">ğŸš«</i> æ’é™¤æ¸¯æ¾³æ¨¡å¼
                            </button>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h3><i class="icon">ğŸ“</i> çœä»½é€‰æ‹©</h3>
                        <div class="control-buttons">
                            <button class="control-btn small" id="selectTop5">
                                <i class="icon">â­</i> é€‰æ‹©å‰5å
                            </button>
                            <button class="control-btn small" id="selectTop10">
                                <i class="icon">ğŸ”¥</i> é€‰æ‹©å‰10å
                            </button>
                            <button class="control-btn small" id="selectAll">
                                <i class="icon">âœ…</i> é€‰æ‹©å…¨éƒ¨çœä»½
                            </button>
                            <button class="control-btn small" id="clearSelection">
                                <i class="icon">ğŸ—‘ï¸</i> æ¸…é™¤é€‰æ‹©
                            </button>
                        </div>
                        
                        <div class="province-selector">
                            <div class="province-grid" id="provinceGrid">
                                <!-- çœä»½é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <div id="densityChart"></div>
            </div>
            
            <div class="stats-info">
                <div class="stat-card">
                    <div class="stat-value" id="selectedCount">0</div>
                    <div class="stat-label">å·²é€‰æ‹©çœä»½æ•°é‡</div>
                    <div class="stat-detail">å…±34ä¸ªçœçº§è¡Œæ”¿åŒº</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="maxDensity">0</div>
                    <div class="stat-label">æœ€é«˜äººå£å¯†åº¦</div>
                    <div class="stat-detail" id="maxProvince">å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDensity">0</div>
                    <div class="stat-label">å¹³å‡äººå£å¯†åº¦</div>
                    <div class="stat-detail">æ‰€é€‰çœä»½çš„å¹³å‡å€¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="minDensity">0</div>
                    <div class="stat-label">æœ€ä½äººå£å¯†åº¦</div>
                    <div class="stat-detail" id="minProvince">å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ</div>
                </div>
            </div>
            
            <div class="footer">
                <p>æ•°æ®æ¥æºï¼š2023å¹´å›½å®¶ç»Ÿè®¡å±€å…¬å¼€æ•°æ®ã€å„çœä»½ç»Ÿè®¡å…¬æŠ¥ | åˆ¶å›¾ï¼šé˜®æ–‡åš | ä½¿ç”¨EChartsç»˜åˆ¶</p>
                <p>æç¤ºï¼šç‚¹å‡»çœä»½å¯å¿«é€Ÿåˆ‡æ¢é€‰æ‹©çŠ¶æ€ï¼ŒåŒå‡»å›¾è¡¨ä¸­çš„æŸ±å½¢å¯æŸ¥çœ‹è¯¦ç»†æ•°æ®</p>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        var myChart = echarts.init(document.getElementById('densityChart'));
        
        // æ‰€æœ‰çœä»½çš„äººå£å¯†åº¦æ•°æ®ï¼ˆåŒ…å«æ¸¯æ¾³å°ï¼ŒæŒ‰äººå£å¯†åº¦ä»é«˜åˆ°ä½æ’åºï¼‰
        var allProvinceData = [
            { name: 'æ¾³é—¨', value: 20718.18, isSpecial: true },
            { name: 'é¦™æ¸¯', value: 6730.79, isSpecial: true },
            { name: 'ä¸Šæµ·', value: 2975.83, isSpecial: false },
            { name: 'åŒ—äº¬', value: 1332.32, isSpecial: false },
            { name: 'å¤©æ´¥', value: 1144.58, isSpecial: false },
            { name: 'æ±Ÿè‹', value: 799.81, isSpecial: false },
            { name: 'å¹¿ä¸œ', value: 707.24, isSpecial: false },
            { name: 'å±±ä¸œ', value: 641.10, isSpecial: false },
            { name: 'æµ™æ±Ÿ', value: 628.12, isSpecial: false },
            { name: 'æ²³å—', value: 592.46, isSpecial: false },
            { name: 'å®‰å¾½', value: 436.78, isSpecial: false },
            { name: 'é‡åº†', value: 387.43, isSpecial: false },
            { name: 'æ²³åŒ—', value: 392.11, isSpecial: false },
            { name: 'æ¹–åŒ—', value: 313.98, isSpecial: false },
            { name: 'æ¹–å—', value: 310.05, isSpecial: false },
            { name: 'ç¦å»º', value: 337.47, isSpecial: false },
            { name: 'è¾½å®', value: 281.85, isSpecial: false },
            { name: 'æ±Ÿè¥¿', value: 270.46, isSpecial: false },
            { name: 'æµ·å—', value: 296.56, isSpecial: false },
            { name: 'å±±è¥¿', value: 221.19, isSpecial: false },
            { name: 'è´µå·', value: 219.48, isSpecial: false },
            { name: 'å¹¿è¥¿', value: 211.57, isSpecial: false },
            { name: 'é™•è¥¿', value: 192.20, isSpecial: false },
            { name: 'å››å·', value: 172.14, isSpecial: false },
            { name: 'å®å¤', value: 140.48, isSpecial: false },
            { name: 'å‰æ—', value: 122.35, isSpecial: false },
            { name: 'äº‘å—', value: 121.95, isSpecial: false },
            { name: 'ç”˜è‚ƒ', value: 57.89, isSpecial: false },
            { name: 'é»‘é¾™æ±Ÿ', value: 67.66, isSpecial: false },
            { name: 'å†…è’™å¤', value: 20.92, isSpecial: false },
            { name: 'æ–°ç–†', value: 15.92, isSpecial: false },
            { name: 'é’æµ·', value: 8.53, isSpecial: false },
            { name: 'è¥¿è—', value: 3.04, isSpecial: false },
            { name: 'å°æ¹¾', value: 647.03, isSpecial: false }
        ];
        
        // åˆå§‹é€‰æ‹©çŠ¶æ€ï¼šé»˜è®¤é€‰æ‹©å‰10å
        var selectedProvinces = allProvinceData.slice(0, 10).map(item => item.name);
        
        // å½“å‰æ˜¾ç¤ºæ¨¡å¼ï¼š'custom'ï¼ˆè‡ªå®šä¹‰ï¼‰, 'top10'ï¼ˆTop10æ’åï¼‰, 'excludeHKMO'ï¼ˆæ’é™¤æ¸¯æ¾³ï¼‰
        var currentMode = 'custom';
        
        // åˆå§‹åŒ–çœä»½é€‰æ‹©å™¨
        function initProvinceSelector() {
            var provinceGrid = $('#provinceGrid');
            provinceGrid.empty();
            
            allProvinceData.forEach(function(province, index) {
                var isSelected = selectedProvinces.includes(province.name);
                var isSpecial = province.isSpecial;
                
                var provinceItem = $('<div class="province-item"></div>');
                if (isSelected) provinceItem.addClass('selected');
                if (isSpecial) provinceItem.addClass('highlight');
                
                provinceItem.html(`
                    <div class="province-checkbox"></div>
                    <div class="province-name">${province.name}</div>
                `);
                
                // ç‚¹å‡»åˆ‡æ¢é€‰æ‹©çŠ¶æ€
                provinceItem.click(function() {
                    var provinceName = province.name;
                    
                    if (selectedProvinces.includes(provinceName)) {
                        // å¦‚æœå·²é€‰æ‹©ï¼Œåˆ™ç§»é™¤
                        selectedProvinces = selectedProvinces.filter(name => name !== provinceName);
                        $(this).removeClass('selected');
                    } else {
                        // å¦‚æœæœªé€‰æ‹©ï¼Œåˆ™æ·»åŠ 
                        selectedProvinces.push(provinceName);
                        $(this).addClass('selected');
                    }
                    
                    updateChart();
                    updateStats();
                });
                
                provinceGrid.append(provinceItem);
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            var selectedData = allProvinceData.filter(p => selectedProvinces.includes(p.name));
            
            if (selectedData.length === 0) {
                $('#selectedCount').text('0');
                $('#maxDensity').text('0');
                $('#avgDensity').text('0');
                $('#minDensity').text('0');
                $('#maxProvince').text('å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ');
                $('#minProvince').text('å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ');
                return;
            }
            
            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            var maxDensity = Math.max(...selectedData.map(d => d.value));
            var minDensity = Math.min(...selectedData.map(d => d.value));
            var avgDensity = selectedData.reduce((sum, d) => sum + d.value, 0) / selectedData.length;
            
            var maxProvince = selectedData.find(d => d.value === maxDensity).name;
            var minProvince = selectedData.find(d => d.value === minDensity).name;
            
            // æ›´æ–°DOM
            $('#selectedCount').text(selectedData.length);
            $('#maxDensity').text(maxDensity.toLocaleString('zh-CN', { maximumFractionDigits: 0 }));
            $('#minDensity').text(minDensity.toLocaleString('zh-CN', { maximumFractionDigits: 0 }));
            $('#avgDensity').text(avgDensity.toLocaleString('zh-CN', { maximumFractionDigits: 0 }));
            $('#maxProvince').text(`${maxProvince} (æœ€é«˜)`);
            $('#minProvince').text(`${minProvince} (æœ€ä½)`);
        }
        
        // æ ¹æ®å½“å‰é€‰æ‹©ç”Ÿæˆå›¾è¡¨æ•°æ®
        function getChartData() {
            // è·å–é€‰ä¸­çš„çœä»½æ•°æ®
            var selectedData = allProvinceData.filter(p => selectedProvinces.includes(p.name));
            
            // æŒ‰äººå£å¯†åº¦ä»é«˜åˆ°ä½æ’åº
            selectedData.sort((a, b) => b.value - a.value);
            
            // æå–åç§°å’Œæ•°å€¼æ•°ç»„
            var provinces = selectedData.map(d => d.name);
            var values = selectedData.map(d => d.value);
            
            // ç”Ÿæˆé¢œè‰²æ•°ç»„ - ä½¿ç”¨æ¸å˜è‰²ï¼Œæ ¹æ®å¯†åº¦å€¼åˆ†é…é¢œè‰²
            var colors = [];
            if (selectedData.length > 0) {
                var maxValue = Math.max(...values);
                var minValue = Math.min(...values);
                
                // å¯¹äºåŒ…å«æ¸¯æ¾³çš„æƒ…å†µï¼Œä½¿ç”¨ç‰¹æ®Šçš„é¢œè‰²å¤„ç†
                var hasSpecial = selectedData.some(d => d.isSpecial);
                
                if (hasSpecial && maxValue > 3000) {
                    // åŒ…å«æ¸¯æ¾³çš„æƒ…å†µï¼šä½¿ç”¨åˆ†æ®µé¢œè‰²
                    selectedData.forEach(d => {
                        if (d.isSpecial) {
                            colors.push('#FF0000'); // æ¸¯æ¾³ç”¨çº¢è‰²
                        } else if (d.value > 600) {
                            colors.push('#FF6B6B'); // é«˜å¯†åº¦ç”¨æ©™çº¢è‰²
                        } else if (d.value > 300) {
                            colors.push('#FFD166'); // ä¸­é«˜å¯†åº¦ç”¨é»„è‰²
                        } else if (d.value > 100) {
                            colors.push('#06D6A0'); // ä¸­å¯†åº¦ç”¨ç»¿è‰²
                        } else {
                            colors.push('#118AB2'); // ä½å¯†åº¦ç”¨è“è‰²
                        }
                    });
                } else {
                    // ä¸åŒ…å«æ¸¯æ¾³æˆ–æ•°å€¼èŒƒå›´è¾ƒå°ï¼šä½¿ç”¨è¿ç»­æ¸å˜
                    selectedData.forEach(d => {
                        var ratio = (d.value - minValue) / (maxValue - minValue);
                        
                        // ä»è“è‰²åˆ°çº¢è‰²çš„æ¸å˜
                        var r = Math.floor(255 * ratio);
                        var g = Math.floor(100 * (1 - ratio));
                        var b = Math.floor(255 * (1 - ratio));
                        
                        colors.push(`rgb(${r}, ${g}, ${b})`);
                    });
                }
            }
            
            return {
                provinces: provinces,
                values: values,
                colors: colors,
                data: selectedData
            };
        }
        
        // åˆ›å»ºå›¾è¡¨é…ç½®
        function createChartOption() {
            var chartData = getChartData();
            var containerWidth = document.getElementById('densityChart').offsetWidth;
            
            // æ ¹æ®å®¹å™¨å¤§å°åŠ¨æ€è°ƒæ•´
            var isSmallScreen = containerWidth < 768;
            var titleFontSize = Math.max(14, Math.min(20, containerWidth / 30));
            var labelFontSize = Math.max(10, Math.min(14, containerWidth / 40));
            
            // æ ¹æ®å½“å‰æ¨¡å¼è®¾ç½®æ ‡é¢˜
            var titleText = '';
            var subtitleText = 'å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ';
            
            switch(currentMode) {
                case 'top10':
                    titleText = '2023å¹´ä¸­å›½å„çœä»½äººå£å¯†åº¦è‡ªå®šä¹‰è¡¨';
                    subtitleText = 'åŒ…å«æ¸¯æ¾³åœ°åŒº | å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ';
                    break;
                case 'excludeHKMO':
                    titleText = '2023å¹´ä¸­å›½å„çœä»½äººå£å¯†åº¦æ’åï¼ˆæ’é™¤æ¸¯æ¾³ï¼‰';
                    subtitleText = 'ä¸å«æ¸¯æ¾³åœ°åŒº | å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ';
                    break;
                case 'custom':
                default:
                    titleText = `è‡ªå®šä¹‰é€‰æ‹© - ${chartData.provinces.length}ä¸ªçœä»½äººå£å¯†åº¦å¯¹æ¯”`;
                    subtitleText = 'å·²é€‰æ‹©' + chartData.provinces.length + 'ä¸ªçœä»½ | å•ä½ï¼šäºº/å¹³æ–¹å…¬é‡Œ';
                    break;
            }
            
            return {
                title: {
                    text: titleText,
                    subtext: subtitleText,
                    left: 'center',
                    textStyle: { 
                        fontSize: titleFontSize, 
                        fontWeight: 'bold',
                        color: '#2c3e50'
                    },
                    subtextStyle: { 
                        fontSize: labelFontSize - 2, 
                        color: '#7f8c8d' 
                    },
                    top: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { 
                        type: 'shadow',
                        shadowStyle: {
                            color: 'rgba(150, 150, 150, 0.2)'
                        }
                    },
                    formatter: function(params) {
                        var data = params[0];
                        var value = data.value.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        var densityLevel = '';
                        
                        if (data.value > 3000) {
                            densityLevel = '<span style="color:#FF0000;font-weight:bold"> (æé«˜å¯†åº¦)</span>';
                        } else if (data.value > 600) {
                            densityLevel = '<span style="color:#FF6B6B;font-weight:bold"> (é«˜å¯†åº¦)</span>';
                        } else if (data.value > 300) {
                            densityLevel = '<span style="color:#FFD166;font-weight:bold"> (ä¸­é«˜å¯†åº¦)</span>';
                        } else if (data.value > 100) {
                            densityLevel = '<span style="color:#06D6A0;font-weight:bold"> (ä¸­å¯†åº¦)</span>';
                        } else {
                            densityLevel = '<span style="color:#118AB2;font-weight:bold"> (ä½å¯†åº¦)</span>';
                        }
                        
                        return `<div style="font-weight: bold; margin-bottom: 5px;">${data.name}</div>
                               <div>äººå£å¯†åº¦: <span style="color: #e74c3c; font-weight: bold">${value}</span> äºº/å¹³æ–¹å…¬é‡Œ${densityLevel}</div>`;
                    },
                    backgroundColor: 'rgba(255,255,255,0.95)',
                    borderColor: '#ddd',
                    borderWidth: 1,
                    textStyle: { fontSize: labelFontSize }
                },
                grid: { 
                    left: isSmallScreen ? '12%' : '8%', 
                    right: '5%', 
                    bottom: isSmallScreen ? '15%' : '10%', 
                    top: isSmallScreen ? '20%' : '18%',
                    containLabel: true 
                },
                xAxis: {
                    type: 'category',
                    data: chartData.provinces,
                    axisLabel: { 
                        rotate: isSmallScreen ? 45 : 30, 
                        interval: 0,
                        fontSize: labelFontSize - 1,
                        color: '#555'
                    },
                    axisLine: { 
                        lineStyle: { 
                            color: '#ccc',
                            width: 1
                        } 
                    },
                    axisTick: {
                        alignWithLabel: true,
                        lineStyle: {
                            color: '#ccc'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'äººå£å¯†åº¦ï¼ˆäºº/å¹³æ–¹å…¬é‡Œï¼‰',
                    nameTextStyle: { 
                        color: '#666',
                        fontSize: labelFontSize - 1,
                        padding: [0, 0, 0, 5]
                    },
                    axisLine: { 
                        lineStyle: { 
                            color: '#ccc',
                            width: 1
                        } 
                    },
                    splitLine: { 
                        lineStyle: { 
                            color: '#f0f0f0',
                            type: 'dashed'
                        } 
                    },
                    axisLabel: {
                        fontSize: labelFontSize - 1,
                        color: '#666'
                    },
                    scale: chartData.data.some(d => d.isSpecial) // å¦‚æœåŒ…å«æ¸¯æ¾³ï¼Œåˆ™ä½¿ç”¨ç¼©æ”¾
                },
                series: [{
                    name: 'äººå£å¯†åº¦',
                    type: 'bar',
                    data: chartData.values.map((value, index) => ({
                        value: value,
                        itemStyle: {
                            color: chartData.colors[index]
                        }
                    })),
                    barWidth: isSmallScreen ? '50%' : '65%',
                    itemStyle: {
                        borderRadius: [6, 6, 0, 0],
                        borderWidth: 0
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.3)'
                        }
                    },
                    label: {
                        show: !isSmallScreen,
                        position: 'top',
                        fontSize: labelFontSize - 1,
                        color: '#555',
                        formatter: function(params) {
                            // å¦‚æœæ•°å€¼è¿‡å¤§ï¼Œæ˜¾ç¤ºç®€å†™å½¢å¼
                            if (params.value > 10000) {
                                return (params.value / 10000).toFixed(1) + 'ä¸‡';
                            } else if (params.value > 1000) {
                                return (params.value / 1000).toFixed(1) + 'åƒ';
                            } else {
                                return params.value.toFixed(0);
                            }
                        }
                    }
                }]
            };
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart() {
            myChart.setOption(createChartOption(), true);
        }
        
        // æ¨¡å¼åˆ‡æ¢å‡½æ•°
        function switchMode(mode) {
            currentMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            $('#modeCustom').removeClass('active');
            $('#modeTop10').removeClass('active');
            $('#modeExcludeHKMO').removeClass('active');
            
            $('#' + 'mode' + mode.charAt(0).toUpperCase() + mode.slice(1)).addClass('active');
            
            // æ ¹æ®æ¨¡å¼æ›´æ–°é€‰æ‹©
            switch(mode) {
                case 'top10':
                    // Top10æ’åæ¨¡å¼ï¼šé€‰æ‹©äººå£å¯†åº¦æœ€é«˜çš„10ä¸ªçœä»½
                    selectedProvinces = allProvinceData.slice(0, 10).map(p => p.name);
                    break;
                    
                case 'excludeHKMO':
                    // æ’é™¤æ¸¯æ¾³æ¨¡å¼ï¼šé€‰æ‹©æ‰€æœ‰éæ¸¯æ¾³çœä»½ä¸­äººå£å¯†åº¦æœ€é«˜çš„10ä¸ª
                    var nonSpecialProvinces = allProvinceData.filter(p => !p.isSpecial);
                    selectedProvinces = nonSpecialProvinces.slice(0, 10).map(p => p.name);
                    break;
                    
                case 'custom':
                default:
                    // è‡ªå®šä¹‰æ¨¡å¼ï¼šä¿æŒå½“å‰é€‰æ‹©
                    break;
            }
            
            // æ›´æ–°é€‰æ‹©å™¨UI
            updateProvinceSelectorUI();
            updateChart();
            updateStats();
        }
        
        // æ›´æ–°çœä»½é€‰æ‹©å™¨UI
        function updateProvinceSelectorUI() {
            $('.province-item').each(function() {
                var provinceName = $(this).find('.province-name').text();
                
                $(this).removeClass('selected');
                if (selectedProvinces.includes(provinceName)) {
                    $(this).addClass('selected');
                }
            });
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            $('#modeCustom').click(function() { switchMode('custom'); });
            $('#modeTop10').click(function() { switchMode('top10'); });
            $('#modeExcludeHKMO').click(function() { switchMode('excludeHKMO'); });
            
            // å¿«é€Ÿé€‰æ‹©æŒ‰é’®
            $('#selectTop5').click(function() {
                selectedProvinces = allProvinceData.slice(0, 5).map(p => p.name);
                updateProvinceSelectorUI();
                updateChart();
                updateStats();
            });
            
            $('#selectTop10').click(function() {
                selectedProvinces = allProvinceData.slice(0, 10).map(p => p.name);
                updateProvinceSelectorUI();
                updateChart();
                updateStats();
            });
            
            $('#selectAll').click(function() {
                selectedProvinces = allProvinceData.map(p => p.name);
                updateProvinceSelectorUI();
                updateChart();
                updateStats();
            });
            
            $('#clearSelection').click(function() {
                selectedProvinces = [];
                updateProvinceSelectorUI();
                updateChart();
                updateStats();
            });
            
            // å›¾è¡¨ç‚¹å‡»äº‹ä»¶ï¼šç‚¹å‡»æŸ±å½¢å¯åˆ‡æ¢è¯¥çœä»½çš„é€‰æ‹©çŠ¶æ€
            myChart.on('click', function(params) {
                if (params.componentType === 'series' && params.seriesType === 'bar') {
                    var provinceName = params.name;
                    
                    if (selectedProvinces.includes(provinceName)) {
                        selectedProvinces = selectedProvinces.filter(name => name !== provinceName);
                    } else {
                        selectedProvinces.push(provinceName);
                    }
                    
                    updateProvinceSelectorUI();
                    updateChart();
                    updateStats();
                }
            });
            
            // çª—å£è‡ªé€‚åº”
            var resizeTimer;
            $(window).resize(function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    myChart.resize();
                }, 200);
            });
        }
        
        // åˆå§‹åŒ–
        $(document).ready(function() {
            initProvinceSelector();
            initEventListeners();
            updateChart();
            updateStats();
            
            // é»˜è®¤åˆ‡æ¢åˆ°Top10æ¨¡å¼
            switchMode('top10');
        });
    </script>
</body>
</html>